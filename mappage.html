<!DOCTYPE html>
<html>
  <head>
  	<link rel="stylesheet" href="purple.css">
    <title>Add Map</title>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIwzALxUPNbatRBj3Xi1Uhp0fFzwWNBkE&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <script>
    	//This code provided by Google initializes a map, and puts it into the <div> with id
    	//="map"
    	var map;
    	function initMap() {

			const SB = { lat: 34.41383554834815, lng: -119.85927027507296 };
			const uluru = { lat: 34.40, lng: -119.84 };
			const contentString =
		    '<div id="content">' +
		    '<div id="siteNotice">' +
		    "</div>" +
		    '<h1 id="firstHeading" class="firstHeading">Uluru</h1>' +
		    '<div id="bodyContent">' +
		    "<p><b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large " +
		    "sandstone rock formation in the southern part of the " +
		    "Northern Territory, central Australia. It lies 335&#160;km (208&#160;mi) " +
		    "south west of the nearest large town, Alice Springs; 450&#160;km " +
		    "(280&#160;mi) by road. Kata Tjuta and Uluru are the two major " +
		    "features of the Uluru - Kata Tjuta National Park. Uluru is " +
		    "sacred to the Pitjantjatjara and Yankunytjatjara, the " +
		    "Aboriginal people of the area. It has many springs, waterholes, " +
		    "rock caves and ancient paintings. Uluru is listed as a World " +
		    "Heritage Site.</p>" +
		    '<p>Attribution: Uluru, <a href="https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">' +
		    "https://en.wikipedia.org/w/index.php?title=Uluru</a> " +
		    "(last visited June 22, 2009).</p>" +
		    "</div>" +
		    "</div>";

			var myStyles =[
			    {
			        featureType: "poi",
			        elementType: "labels",
			        stylers: [
			              { visibility: "off" }
			        ]
			    }
			];

			map = new google.maps.Map(document.getElementById("map"), {
			    zoom: 12,
			    center: SB,
			    styles: myStyles,
			    gestureHandling: 'greedy',
			    mapTypeId: 'terrain'
			});
			var infoWindow = new google.maps.InfoWindow();
			const infowindow2 = new google.maps.InfoWindow({
			    content: contentString,
			  });
			const marker = new google.maps.Marker({
		    position: uluru,
		    map,
		    title: "Uluru (Ayers Rock)",
		  });
			marker.addListener("click", () => {
				console.log("test")
		    infowindow2.open(map, marker);
		  });
		

		    // Try HTML5 geolocation.
		    if (navigator.geolocation) {
		      navigator.geolocation.getCurrentPosition(
		        (position) => {
		          const pos = {
		            lat: position.coords.latitude,
		            lng: position.coords.longitude,
		          };
		          infoWindow.setPosition(pos);
		          infoWindow.setContent("You are here.");
		          infoWindow.open(map);
		          map.setCenter(pos);
		        },
		        () => {
		          handleLocationError(true, infoWindow, map.getCenter());
		        }
		      );
		    } else {
		      // Browser doesn't support Geolocation
		      handleLocationError(false, infoWindow, map.getCenter());
		    }
		  
		}

		//This code prepares and sends an XML http request, which will go to our server with a
		//link and return with data (restaurant coords, etc).
		function getData() {

		    var xhttp = new XMLHttpRequest();
		    xhttp.onreadystatechange = function() {
		         if (this.readyState == 4 && this.status == 200) {
		             document.getElementById("demo").innerHTML = this.responseText;
		             var temp = JSON.parse(this.responseText);
		             for(var i = 0; i < temp.length; i++){
					    marker = new google.maps.Marker({
					    	position: temp[i].coords,
					    	map: map
					    });
		             }
		         }
		    };
		    xhttp.open("GET", "http://localhost:5000", true);
  			xhttp.send();
		}
    </script>
    <style>
    	#map {
		  height: 500px;
		  width: 900px;
		}
		#header {
			font-size: 30px;
		}
		#container1{
			margin:0 auto;
			height: 700px;
			width:1000px;
		}
    </style>
  </head>
  <body>
  	<div id="container1">
    <h3 id="header">My Google Maps Demo</h3>
    <!--The div element for the map -->
    <div id="map"></div>
    <button class="tm-btn" type="button" onclick="getData()">Request data</button>
    <p id="demo"></p>
	</div>
  </body>
</html>